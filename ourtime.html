<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link rel="icon" type="image/png" href="images/favicon.png">
        <!-- Tiêu đề của trang dòng thời gian -->
		<title>MY LOVE</title>	    
        <link type="text/css" rel="stylesheet" href="default.css">
        <link rel="stylesheet" href="style.css">
		<script type="text/javascript" src="secret/js/jquery.min.js"></script>
		<script type="text/javascript" src="secret/js/jscex.min.js"></script>
		<script type="text/javascript" src="secret/js/jscex-parser.js"></script>
		<script type="text/javascript" src="secret/js/jscex-jit.js"></script>
		<script type="text/javascript" src="secret/js/jscex-builderbase.min.js"></script>
		<script type="text/javascript" src="secret/js/jscex-async.min.js"></script>
		<script type="text/javascript" src="secret/js/jscex-async-powerpack.min.js"></script>
		<script type="text/javascript" src="secret/js/functions.js" charset="utf-8"></script>
		<script type="text/javascript" src="secret/js/love.js" charset="utf-8"></script>
	    <style type="text/css"></style>

</head>
    <body style="background-image: url(images/bg_ourtime.jpg)">
        <div id="main">
             <div id="wrap">
                <div id="text">
                    <div id="code">
                        <div class="message">
                            Hôm nay là ngày kỷ niệm tròn 1 năm chúng mình bên nhau. Cảm ơn bé đã luôn bên cạnh anh trong suốt quãng thời gian qua. Cảm ơn bé đã mang đến cho anh những khoảnh khắc bình yên và hạnh phúc, làm cho cuộc sống của anh thêm phần rực rỡ. Một năm không phải là quá dài, nhưng đủ để anh biết rằng mình muốn cùng em đi tiếp trên con đường phía trước, không chỉ 1 năm mà là cả những chặng đường dài sau này.<br>
                            <br>Yêu bé nhiều,
                            <span class="special-line"><b>Anh bé aka Dịt iuu</b></span>
                        </div>                        
                    </div>
                </div>
                <div class="countdown-container">
                    <span class="STYLE1">Thời gian bên nhauuu</span>
                    <div id="countdown">
                        <div><span id="days"></span> Ngày</div>
                        <div><span id="hours"></span> Giờ</div>
                        <div><span id="minutes"></span> Phút</div>
                        <div><span id="seconds"></span> Giây</div>
                    </div>
                 </div>
                <canvas id="canvas" width="1920" height="1080"></canvas>
            </div> 
        </div>
        <div class="buttons">
            <a href="index.html" class="btn btn-bir">Quay lại</a>
        </div>

    <!-- Phần nhạc -->
    <audio id="player" autoplay loop>
        <source src="nhac.mp3" type="audio/mp3" />
    </audio>
    <script>
    (function(){
        var canvas = $('#canvas');
		
        if (!canvas[0].getContext) {
            $("#error").show();
            return false;        }

        var width = canvas.width();
        var height = canvas.height();        
        canvas.attr("width", width);
        canvas.attr("height", height);
        var opts = {
            seed: {
                x: width / 2 - 20,
                color: "rgb(190, 26, 37)",
                scale: 2
            },
            branch: [
                [535, 680, 570, 250, 500, 200, 30, 100, [
                    [540, 500, 455, 417, 340, 400, 13, 100, [
                        [450, 435, 434, 430, 394, 395, 2, 40]
                    ]],
                    [550, 445, 600, 356, 680, 345, 12, 100, [
                        [578, 400, 648, 409, 661, 426, 3, 80]
                    ]],
                    [539, 281, 537, 248, 534, 217, 3, 40],
                    [546, 397, 413, 247, 328, 244, 9, 80, [
                        [427, 286, 383, 253, 371, 205, 2, 40],
                        [498, 345, 435, 315, 395, 330, 4, 60]
                    ]],
                    [546, 357, 608, 252, 678, 221, 6, 100, [
                        [590, 293, 646, 277, 648, 271, 2, 80]
                    ]]
                ]] 
            ],
            bloom: {
                num: 700,
                width: 1080,
                height: 650,
            },
            footer: {
                width: 1920,
                height: 5,
                speed: 10,
            }
        }

        var tree = new Tree(canvas[0], width, height, opts);
        var seed = tree.seed;
        var foot = tree.footer;
        var hold = 1;

        canvas.click(function(e) {
            var offset = canvas.offset(), x, y;
            x = e.pageX - offset.left;
            y = e.pageY - offset.top;
            if (seed.hover(x, y)) {
                hold = 0; 
                canvas.unbind("click");
                canvas.unbind("mousemove");
                canvas.removeClass('hand');
            }
        }).mousemove(function(e){
            var offset = canvas.offset(), x, y;
            x = e.pageX - offset.left;
            y = e.pageY - offset.top;
            canvas.toggleClass('hand', seed.hover(x, y));
        });

        var seedAnimate = eval(Jscex.compile("async", function () {
            seed.draw();
            while (hold) {
                $await(Jscex.Async.sleep(10));
            }
            while (seed.canScale()) {
                seed.scale(0.95);
                $await(Jscex.Async.sleep(10));
            }
            while (seed.canMove()) {
                seed.move(0, 2);
                foot.draw();
                $await(Jscex.Async.sleep(10));
            }
        }));

        var growAnimate = eval(Jscex.compile("async", function () {
            do {
    	        tree.grow();
                $await(Jscex.Async.sleep(10));
            } while (tree.canGrow());
        }));

        var flowAnimate = eval(Jscex.compile("async", function () {
            do {
    	        tree.flower(2);
                $await(Jscex.Async.sleep(10));
            } while (tree.canFlower());
        }));

        var moveAnimate = eval(Jscex.compile("async", function () {
            tree.snapshot("p1", 240, 0, 610, 680);
            while (tree.move("p1", 500, 0)) {
                foot.draw();
                $await(Jscex.Async.sleep(10));
            }
            foot.draw();
            tree.snapshot("p2", 500, 0, 610, 680);

            canvas.parent().css("background", "url(" + tree.toDataURL('image/png') + ")");
            canvas.css("background-color", "transparent");
            $await(Jscex.Async.sleep(300));
            canvas.css("background", "none");
        }));

        var jumpAnimate = eval(Jscex.compile("async", function () {
            var ctx = tree.ctx;
            while (true) {
                tree.ctx.clearRect(0, 0, width, height);
                tree.jump();
                foot.draw();
                $await(Jscex.Async.sleep(25));
            }
        }));

        var textAnimate = async function() {
            // Set the date of the event (October 20, 2023)
            var together = new Date();
            var year = 2023, month = 10, day = 20;
            together.setFullYear(year, month - 1, day);
            together.setHours(0);
            together.setMinutes(0);
            together.setSeconds(0);
            together.setMilliseconds(0);
            
            // Show the code element
            $("#code").show();
            $(".countdown-container").show(); // Hiển thị bộ đếm

            // Loop to update the elapsed time
            while (true) {
                // Calculate elapsed time
                const now = new Date().getTime(); // Current date and time
                const gap = now - together.getTime(); // Calculate the elapsed time since the event
    
                const second = 1000;
                const minute = second * 60;
                const hour = minute * 60;
                const day = hour * 24;
    
                // Calculate days, hours, minutes, and seconds
                const textDay = Math.floor(gap / day);
                const textHour = Math.floor((gap % day) / hour);
                const textMinute = Math.floor((gap % hour) / minute);
                const textSecond = Math.floor((gap % minute) / second);
    
                // Update the countdown display
                document.getElementById("days").innerText = textDay;
                document.getElementById("hours").innerText = textHour;
                document.getElementById("minutes").innerText = textMinute;
                document.getElementById("seconds").innerText = textSecond;
    
                // Wait for 1 second before updating again
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        };
        
        var runAsync = eval(Jscex.compile("async", function() {
            $await(seedAnimate());
            $await(growAnimate());
            $await(flowAnimate());
            $await(moveAnimate());
    
            // Call textAnimate after all animations are done
            textAnimate().start();
            $await(jumpAnimate());
        }));
    
        runAsync().start();
    })();
    </script>
</div>
</body>
</html>
